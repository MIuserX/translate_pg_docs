

## 68.1 数据库文件格式



## 68.2 `TOAST`



## 68.3 Free Space Map



## 68.4 可见性地图

​		每个堆表都有一个可见性地图（Visibility Map；VM）来保持跟踪：哪个页仅包含已知对所有活跃的事务都可见的元组；它还跟踪哪个页仅包含冻结元组。它被存储在主要表数据的旁边，在一个独立的表结构 fork 空间内，命名是表的文件 node 后跟着 `_vm` 后缀。例如，如果文件 node 是 12345，VM 被存储在一个叫做 `12345_vm` 的文件中，在相同的目录中是主表文件。注意，所以没有 VM。

​		可见性地图在每个 heap page 上存储了两个 bit。第一个 bit，如果设置了，显示这个页上的所有元组对于所有活跃事务都是可见的，或者说，这个页没有包含任何需要 vacuum 的元组。这个信息也可以被 [index-only scan](https://www.postgresql.org/docs/13/indexes-index-only-scans.html) 使用来应答仅使用索引元组的查询。第二个 bit，如果设置了，意味着在这个页上的所有元组都被冻结了。这意味着甚至一个反回卷 vacuum 都不需要重新访问这个页。



* 可用元组（空）
* 冻结元组（冻结）：对所有活跃事务可见
* 已死亡但未回收元组（死亡）：
* 活跃元组（活跃）：不一定对所有活跃事务可见



## 68.5 初始化 Fork



## 68.6 数据库页格式



